library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
View(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_results_total_population"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[1]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[1], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
source("R/functions/postprocessing_functions.R")
name <- "oPt_mpca_results_total_population"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[1]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[1], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
r=response
#replacing all expenditures to NA whose total expenses are NA
r$shelter_need <- case_when(r$shelter == "fully_able" ~ 5,
r$shelter == "partially_able" ~ 1.5,
r$shelter == "mostly_able" ~ 3.5,
r$shelter == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$food_need <- case_when(r$food == "fully_able" ~ 5,
r$food == "partially_able" ~ 1.5,
r$food == "mostly_able" ~ 3.5,
r$food == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$water_need <- case_when(r$water == "fully_able" ~ 5,
r$water == "partially_able" ~ 1.5,
r$water == "mostly_able" ~ 3.5,
r$water == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$hygiene_need <- case_when(r$hygiene == "fully_able" ~ 5,
r$hygiene == "partially_able" ~ 1.5,
r$hygiene == "mostly_able" ~ 3.5,
r$hygiene == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$health_need <- case_when(r$health == "fully_able" ~ 5,
r$health == "partially_able" ~ 1.5,
r$health == "mostly_able" ~ 3.5,
r$health == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$education_need <- case_when(r$education == "fully_able" ~ 5,
r$education == "partially_able" ~ 1.5,
r$education == "mostly_able" ~ 3.5,
r$education == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$energy_need <- case_when(r$energy == "fully_able" ~ 5,
r$energy == "partially_able" ~ 1.5,
r$energy == "mostly_able" ~ 3.5,
r$energy == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$transportation_need <- case_when(r$transportation == "fully_able" ~ 5,
r$transportation == "partially_able" ~ 1.5,
r$transportation == "mostly_able" ~ 3.5,
r$transportation == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$hh_items_need <- case_when(r$hh_items == "fully_able" ~ 5,
r$hh_items == "partially_able" ~ 1.5,
r$hh_items == "mostly_able" ~ 3.5,
r$hh_items == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$communication_need <- case_when(r$communication == "fully_able" ~ 5,
r$communication == "partially_able" ~ 1.5,
r$communication == "mostly_able" ~ 3.5,
r$communication == "completely_unable" ~ 0,
TRUE ~ NA_real_)
r$total_need <- r$shelter_need + r$food_need + r$water_need + r$hygiene_need + r$health_need + r$education_need + r$energy_need + r$transportation_need + r$hh_items_need + r$communication_need
r$average_need <-round(r$total_need/50, 2)
r$msi <- case_when(r$average_need <= 0.50 ~ 1,
r$average_need > 0.50 ~0,
TRUE ~ NA_real_)
prop.table(table(r$msi))
r$msi <- case_when(r$average_need <= 0.50 ~ 0,
r$average_need > 0.50 ~1,
TRUE ~ NA_real_)
prop.table(table(r$msi))
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_results_total_population"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[1]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[1], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_total_poulation_05012022"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_total_poulation_05012022"
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "hhh_gender"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
# analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
View(analysisplan)
analysisplan$repeat.for.variable <- "hhh_gender"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
# analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
View(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_gender_disagg_poulation_11012022"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
View(summary)
source("R/functions/postprocessing_functions.R")
name <- "oPt_mpca_gender_disagg_poulation_11012022"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$repeat.for.variable <- "HH_with_Disability"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
# analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
View(analysisplan)
name <- "oPt_mpca_disability_disagg_poulation_11012022"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$repeat.for.variable <- "HH_with_chronic_disease"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
# analysisplan <- analysisplan_nationwide(analysisplan)
analysisplan <- analysisplan_pop_group_aggregated(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_chronic_disagg_poulation_11012022"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
