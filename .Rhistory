# # start <- ifelse(camp, 1, 19)
# # df <- data.frame(governorate = lookup_table$filter[start:nrow(lookup_table)][match(districts, lookup_table$name[start:nrow(lookup_table)])],
# #                  district = districts, stringsAsFactors = F)
# # df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
# #   df[,vars[i]] <- var_result[var_result$repeat.var.value, "numbers"]
# # df[,sprintf("%s_min", vars[i])] <- var_result[match(df$district, var_result$repeat.var.value), "min"]
# # df[,sprintf("%s_max", vars[i])] <- var_result[match(df$district, var_result$repeat.var.value), "max"]
}
View(var_result)
View(var_result)
extra_heading <- data.frame(t(vars), stringsAsFactors = F)
colnames(extra_heading) <- vars
extra_heading[1,] <- t(analplan_subset[,1][match(vars, analplan_subset$dependent.variable)])
extra_heading[2,] <- t(analplan_subset$research.question[match(vars, analplan_subset$dependent.variable)])
extra_heading[3,] <- t(analplan_subset$sub.research.question[match(vars, analplan_subset$dependent.variable)])
extra_heading[4,] <- t(analplan_subset$dependent.variable.type[match(vars, analplan_subset$dependent.variable)])
View(extra_heading)
, cluster_lookup_table, lookup_table, severity = FALSE, camp=FALSE
subset <- summary[which(summary$independent.var.value == independent.var.value),]
independent.var <- subset$independent.var[1]
if(is.na(independent.var)) {
analplan_subset <- analysisplan
} else {
analplan_subset <- analysisplan[which(analysisplan$independent.variable == independent.var),]
}
vars <- unique(subset$dependent.var)
# districts <- unique(subset$repeat.var.value)
# start <- ifelse(camp, 1, 19)
# df <- data.frame(governorate = lookup_table$filter[start:nrow(lookup_table)][match(districts, lookup_table$name[start:nrow(lookup_table)])],
#                  district = districts, stringsAsFactors = F)
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <- var_result[var_result$repeat.var.value, "numbers"]
df[,sprintf("%s_min", vars[i])] <- var_result[var_result$repeat.var.value,"min"]
df[,sprintf("%s_max", vars[i])] <- var_result[var_result$repeat.var.value, "max"]
}
var_result <- subset[which(subset$dependent.var == vars[i]),]
var_result <- subset[which(subset$dependent.var == vars[30]),]
View(var_result)
var_result <- subset[which(subset$dependent.var == vars[1]),]
View(var_result)
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <- var_result$numbers
df[,sprintf("%s_min", vars[i])] <- var_result$min
# districts <- unique(subset$repeat.var.value)
# start <- ifelse(camp, 1, 19)
# df <- data.frame(governorate = lookup_table$filter[start:nrow(lookup_table)][match(districts, lookup_table$name[start:nrow(lookup_table)])],
#                  district = districts, stringsAsFactors = F)
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <- var_result$numbers
df[,sprintf("%s_min", vars[i])] <- var_result$min
df[,sprintf("%s_max", vars[i])] <- var_result$max
}
# districts <- unique(subset$repeat.var.value)
# start <- ifelse(camp, 1, 19)
# df <- data.frame(governorate = lookup_table$filter[start:nrow(lookup_table)][match(districts, lookup_table$name[start:nrow(lookup_table)])],
#                  district = districts, stringsAsFactors = F)
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <- ""
df[,sprintf("%s_min", vars[i])] <- ""
df[,sprintf("%s_max", vars[i])] <- ""
}
View(var_result)
extra_heading <- data.frame(t(vars), stringsAsFactors = F)
colnames(extra_heading) <- vars
extra_heading[1,] <- t(analplan_subset[,1][match(vars, analplan_subset$dependent.variable)])
extra_heading[2,] <- t(analplan_subset$research.question[match(vars, analplan_subset$dependent.variable)])
extra_heading[3,] <- t(analplan_subset$sub.research.question[match(vars, analplan_subset$dependent.variable)])
extra_heading[4,] <- t(analplan_subset$dependent.variable.type[match(vars, analplan_subset$dependent.variable)])
View(extra_heading)
vars <- unique(subset$dependent.var)
# districts <- unique(subset$repeat.var.value)
# start <- ifelse(camp, 1, 19)
df <- data.frame(governorate = gaza,
district = gaza, stringsAsFactors = F)
# districts <- unique(subset$repeat.var.value)
# start <- ifelse(camp, 1, 19)
df <- data.frame(governorate = "gaza",
district = "gaza", stringsAsFactors = F)
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <- ""
df[,sprintf("%s_min", vars[i])] <- ""
df[,sprintf("%s_max", vars[i])] <- ""
}
View(df)
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <-  var_result$numbers
df[,sprintf("%s_min", vars[i])] <- var_result$min
df[,sprintf("%s_max", vars[i])] <- var_result$max
}
# df <- df[with(df, order(governorate, district)),]
for(i in 1:length(vars)){
var_result <- subset[which(subset$dependent.var == vars[i]),]
df[,vars[i]] <-  var_result$numbers[i]
df[,sprintf("%s_min", vars[i])] <- var_result$min[i]
df[,sprintf("%s_max", vars[i])] <- var_result$max[i]
}
extra_heading <- data.frame(t(vars), stringsAsFactors = F)
colnames(extra_heading) <- vars
extra_heading[1,] <- t(analplan_subset[,1][match(vars, analplan_subset$dependent.variable)])
extra_heading[2,] <- t(analplan_subset$research.question[match(vars, analplan_subset$dependent.variable)])
extra_heading[3,] <- t(analplan_subset$sub.research.question[match(vars, analplan_subset$dependent.variable)])
# if (severity){
#   extra_heading[5,] <- t(analplan_subset$consequence[match(vars, analplan_subset$dependent.variable)])
# }
df <- rbind.fill(df, extra_heading)
df <- df[c((nrow(df)-(nrow(extra_heading) - 1)):nrow(df),1:(nrow(df)-nrow(extra_heading))),]
# df$district <- lookup_table$english[match(df$district, lookup_table$name)]
# if(!camp){df$governorate <- lookup_table$english[match(df$governorate, lookup_table$name)]}
df[1:nrow(extra_heading), which(is.na(df[1,]))] <- ""
df
View(df)
source("R/functions/postprocessing_functions.R")
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
#dap_name <- "oPt_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
name <- "oPt_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
#dap_name <- "oPt_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
summary_gov<- summary
source("R/functions/postprocessing_functions.R")
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
#dap_name <- "oPt_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
summary_gov<- summary
df2 <- rbind(summary_female, summary_male, summary_refugee, summary_non_refugee, summary_in_camp_refugee, summary_out_camp_refugee, summary_governorate)
write.csv(df, sprintf("output/raw_results/df_results_%s_filtered.csv", name), row.names=F)
response$gaggi <- ifelse(response$remote_learning > response$tot_school_aged, 1,0)
response$tot_school_aged <- response$school_girls_5_10 + response$school_girls_11_15 +
response$school_girls_16_17 + response$school_boys_5_10 + response$school_boys_11_15 +
response$school_boys_16_17
table(response$gaggi)
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
#dap_name <- "oPt_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
library(readr)
library(tidyverse)
r <-read_csv("Input/datasets/cleaned/mpca_data_clean.csv")
r_per_female <- round((r$tot_female/r$hh_size)*100,0)
r$per_female <- round((r$tot_female/r$hh_size)*100,0)
r$per_female
r$per_male <- round((r$tot_male/r$hh_size)*100,0)
r$per_male
r$per_children <- round(((r$tot_boys + r$tot_boys)/r$hh_size)*100,0)
r$per_children
r$per_children <- round(((r$tot_boys + r$tot_girls)/r$hh_size)*100,0)
r$per_children
##%of house by age groups: adults
r$per_adults <- round((r$tot_adults / r$hh_size)*100,0)
r$per_adults
mean
##average household size
r$average_hh_size <- mean(r$hh_size, na.rm = TRUE)
r$average_hh_size
##average household size
r$average_hh_size <- round(mean(r$hh_size, na.rm = TRUE),0)
r$average_hh_size
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#SETUP
rm(list=ls(all=T))
R.version
library(rlang)
library(xlsx)
library(plyr) # rbind.fill
library(dplyr)
library(expss)
library(reshape)
library(data.table)
library(miceadds)
library(questionr)
library(koboquest) # manage kobo questionnairs
library(kobostandards) # check inputs for inconsistencies
library(xlsformfill) # generate fake data for kobo
library(surveyweights) # calculate weights from samplingframes
library(hypegrammaR) # simple stats 4 complex samples
library(composr) # horziontal operations
source("R/functions/postprocessing_functions.R")
source("R/functions/to_alphanumeric_lowercase.R")
source("R/functions/analysisplan_factory.R")
source("R/functions/Binary_Recoding.R")
#LOAD INPUT FILES
source("R/1_load_inputs.R",local = T)
response_with_composites <- recoding_preliminary(response)
#LOAD ANALYSISPLAN
dap_name <- "mpca_preliminary"
#dap_name <- "oPt_preliminary"
analysisplan <- read.csv(sprintf("input/dap/dap_%s.csv",dap_name), stringsAsFactors = F)
analysisplan$independent.variable <-  "refugee_status"
analysisplan$independent.variable.type <- "categorical"
#AGGREGATE ACROSS DISTRICTS OR/AND POPULATION GROUPS
analysisplan <- analysisplan_nationwide(analysisplan)
result <- from_analysisplan_map_to_output(response_with_composites, analysisplan = analysisplan,
questionnaire = questionnaire, confidence_level = 0.95)
name <- "oPt_mpca_refugee_disagg"
saveRDS(result,paste(sprintf("output/RDS/result_%s.RDS", name)))
summary <- bind_rows(lapply(result[[1]], function(x){x$summary.statistic}))
write.csv(summary, sprintf("output/raw_results/raw_results_%s.csv", name), row.names=F)
summary <- read.csv(sprintf("output/raw_results/raw_results_%s.csv", name), stringsAsFactors = F)
summary <- correct.zeroes(summary)
summary <- summary %>% filter(dependent.var.value %in% c(NA,1))
write.csv(summary, sprintf("output/raw_results/raw_results_%s_filtered.csv", name), row.names=F)
if(all(is.na(summary$independent.var.value))){summary$independent.var.value <- "all"}
groups <- unique(summary$independent.var.value)
groups <- groups[!is.na(groups)]
library(plyr)
for (i in 1:length(groups)) {
df <- pretty.output(summary, groups[i], analysisplan)
write.csv(df, sprintf("output/summary_sorted/summary_sorted_%s_%s.csv", name, groups[i]), row.names = F)
if(i == 1){
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], row.names=FALSE)
} else {
write.xlsx(df, file=sprintf("output/summary_sorted/summary_sorted_%s.xlsx", name), sheetName=groups[i], append=TRUE, row.names=FALSE)
}
}
